---
title: Partitioning Theory
tags:
---

* MBR( Master Boot Record )
* GPT(  )
* 只规定了分区，不规定文件系统

# MBR

MBR磁盘分区是一种使用最为广泛的分区结构，它也被称为DOS分区结构，但它并不仅仅应用于Windows系统平台，也应用于Linux，基于X86的UNIX等系统平台。它位于磁盘的0号扇区（一扇区等于512字节），是一个重要的扇区（简称MBR扇区）。

MBR扇区由以下四部分组成：

引导代码：引导代码占MBR分区的前440字节，负责整个系统启动。如果引导代码被破坏，系统将无法启动。

Windows磁盘签名：占引导代码后面的4字节，是Windows初始化磁盘写入的磁盘标签，如果此标签被破坏，则系统会提示“初始化磁盘”。

MBR分区表：占Windows磁盘标签后面的64个字节，是整个硬盘的分区表。

MBR结束标志：占MBR扇区最后2个字节，一直为“55 AA”。





一个硬盘，只能有4个主分区， 

（恢复分区也占一个分区）

（微软引导占一个）

（微软OS占一个C盘分区）

（剩下的一个主分区可以做扩展分区，做出最多4个逻辑分区）

在这样的情况下，是没法双系统的，因为4个主分区已经用完了

* MBR用32位寻址，每个bit代表512字节，因此只能支持2T硬盘



512字节：446字节内容特指为“主引导记录”——MBR

4个16字节的“磁盘分区表”——DPT

2字节的结束标志——检验主引导记录是否有效的标志

注：在MBR分区表中，一个分区最大的容量为2T，且每个分区的起始柱面必须在这个硬盘的前2T内。你有一个3T的硬盘，根据要求你至少要把它划分为2个分区，且最后一个分区的起始扇区要位于硬盘的前2T空间内。如果硬盘太大则必须改用GPT。

标准MBR结构：

![gpt和mbr的区别（一文读懂gpt和mbr） (http://www.cangzhai.com/) 珠宝文玩 第1张](https://www.agrj.cn/zb_users/upload/2021/12/20211202170326_64901.jpg)



# EBR

由于MBR仅仅为分区表保留了64字节的存储空间，而每个分区则占用16字节的空间，也就是只能分4个分区，而4个分区在实际情况下往往是不够用的。因此就有了扩展分区，扩展分区中的每个逻辑分区的分区信息都存在一个类似MBR的扩展引导记录(简称EBR)中，扩展引导记录包括分区表和结束标志“55 AA”，没有引导代码部分。



位于Extended Boot Record（扩展引导记录）中的分区表，结构类似于MBR，该分区表所描述的分区即扩展分区。每个EBR仅表示了一个扩展分区，该扩展分区紧接在它的EBR后。EBR中的四个分区描述符中的第一个指向扩展分区本身的引导扇区，第二个描述符则表示下一个扩展分区的EBR（如果是最后一个则为空），也就是说，各个EBR串接成了一个EBR链表，第三、第四项没有使用。

# GPT

全局唯一标识分区表（GUID Partition Table）

![gpt和mbr的区别（一文读懂gpt和mbr） (http://www.cangzhai.com/) 珠宝文玩 第2张](https://www.agrj.cn/zb_users/upload/2021/12/20211202170327_82138.jpg)

1. 保护MBR：

前512字节（0号扇区）有个保护MBR（用于防止不识别GPT的硬盘工具错误识别并破坏硬盘中的数据），这个MBR中只有一个类型为0xEE的分区，以此来表示这块硬盘使用GPT分区表。不能识别GPT硬盘的操作系统通常会识别出一个未知类型的分区，并且拒绝对硬盘进行操作；能够识别GPT分区表的操作系统会检查保护MBR中的分区表，如果分区类型不是0xEE或者MBR分区表中有多个项，也会拒绝对硬盘进行操作



2. GPT：

GPT头位于GPT磁盘的第二个磁盘，也就是1号扇区，该扇区是在创建GPT磁盘时生成，GPT头会定义分区表的起始位置，分区表的结束位置、每个分区表项的大小、分区表项的个数及分区表的校验和等信息。



3. 分区表：

分区表位于GPT磁盘的2-33号磁盘，一共占用32个扇区，能够容纳128个分区表项。每个分区表项大小为128字节。因为每个分区表项管理一共分区，所以Windows系统允许GPT磁盘创建128个分区

4. 分区区域

  GPT分区区域就是用户使用的分区，也是用户进行数据存储的区域。分区区域的起始地址和结束地址由GPT头定义。

5. GPT头备份

  GPT头有一个备份，放在GPT磁盘的最后一个扇区，但这个GPT头备份并非完全GPT头备份，某些参数有些不一样。复制的时候根据实际情况更改一下即可。

6. 分区表备份

  分区区域结束后就是分区表备份，其地址在GPT头备份扇区中有描述。分区表备份是对分区表32个扇区的完整备份。如果分区表被破坏，系统会自动读取分区表备份，也能够保证正常识别分区。

可以有很多主分区，也就不需要扩展分区和逻辑分区了



最大硬盘容量9.4ZB

 缺点是浪费更多的磁盘空间



保留，用于MBR

后512字节用于GPT Header

然后是分区表， 分区表在磁盘尾部又会备份一遍



# ESP

# ESP

即EFI系统分区（EFI system partition），是一个FAT16或FAT32格式的物理分区，其分区标识是EF (十六进制) 而非常规的0E或0C。该分区在Windows操作系统下一般是不可见的。ESP分区是一个独立于操作系统之外的分区，操作系统被引导后就不再依赖它。分区内存放引导管理程序、驱动程序、系统维护工具等。支持 EFI 模式的电脑需要从ESP启动系统，EFI固件可从ESP加载EFI启动程序和应用程序

# File System

## 微软：

普通磁盘：

* NTFS

* 比NTFS更早：fat32（磁盘最大32G,单个文件最大4G）, fat16



U盘：exfat

## linux

ext1,2,3,4

如果不指定挂载，那么子目录就在父目录所在的分区上

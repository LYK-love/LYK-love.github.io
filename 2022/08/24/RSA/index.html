<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/white_flower1.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/white_flower1.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/white_flower1.jpg">
  <link rel="mask-icon" href="/images/white_flower1.jpg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha256-AbA177XfpSnFEvgpYu1jMygiLabzPCJCRIBtR5jGc0k=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"lyk-love.cn","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.13.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":"flat"},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":"enable","trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Outline:  Intro Prerequisites Key Generation Reliability Encription &amp;&amp; Decription Key Format Use RSA">
<meta property="og:type" content="article">
<meta property="og:title" content="RSA">
<meta property="og:url" content="http://lyk-love.cn/2022/08/24/RSA/index.html">
<meta property="og:site_name" content="LYK-love">
<meta property="og:description" content="Outline:  Intro Prerequisites Key Generation Reliability Encription &amp;&amp; Decription Key Format Use RSA">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-08-23T23:31:16.000Z">
<meta property="article:modified_time" content="2022-09-26T06:39:34.938Z">
<meta property="article:author" content="有多远滚多远">
<meta property="article:tag" content="Computer Networking">
<meta property="article:tag" content="Cryptology">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://lyk-love.cn/2022/08/24/RSA/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://lyk-love.cn/2022/08/24/RSA/","path":"2022/08/24/RSA/","title":"RSA"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>RSA | LYK-love</title>
  

  <script src="/js/third-party/analytics/baidu-analytics.js"></script>
  <script async src="https://hm.baidu.com/hm.js?07a572cad308bc3b22d354fca4209fed"></script>





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="LYK-love" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">LYK-love</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Intro"><span class="nav-text">Intro</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#PrerequisiFtes"><span class="nav-text">PrerequisiFtes</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%92%E8%B4%A8"><span class="nav-text">互质</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AC%A7%E6%8B%89%E5%87%BD%E6%95%B0"><span class="nav-text">欧拉函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%AC%A7%E6%8B%89%E5%AE%9A%E7%90%86"><span class="nav-text">欧拉定理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B4%B9%E9%A9%AC%E5%B0%8F%E5%AE%9A%E7%90%86"><span class="nav-text">费马小定理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E5%8F%8D%E5%85%83%E7%B4%A0"><span class="nav-text">模反元素</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Key-Generation"><span class="nav-text">Key Generation</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E6%A8%A1%E5%8F%8D%E5%85%83%E7%B4%A0-d"><span class="nav-text">计算模反元素 $d$</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Encription-Decription"><span class="nav-text">Encription &amp;&amp; Decription</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Example"><span class="nav-text">Example</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Proof"><span class="nav-text">Proof</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Reliability"><span class="nav-text">Reliability</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Key-Format"><span class="nav-text">Key Format</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Use-RSA"><span class="nav-text">Use RSA</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="有多远滚多远"
      src="/images/white_flower1.jpg">
  <p class="site-author-name" itemprop="name">有多远滚多远</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">210</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">50</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/LYK-love" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;LYK-love" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:191820133@smail.nju.edu.cn" title="E-Mail → mailto:191820133@smail.nju.edu.cn" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://lyk-love.cn/2022/08/24/RSA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/white_flower1.jpg">
      <meta itemprop="name" content="有多远滚多远">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="LYK-love">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="RSA | LYK-love">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          RSA
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-08-23 23:31:16" itemprop="dateCreated datePublished" datetime="2022-08-23T23:31:16Z">2022-08-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2022-09-26 06:39:34" itemprop="dateModified" datetime="2022-09-26T06:39:34Z">2022-09-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Computer-Science/" itemprop="url" rel="index"><span itemprop="name">Computer Science</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>Outline:</p>
<ul>
<li>Intro</li>
<li>Prerequisites</li>
<li>Key Generation</li>
<li>Reliability</li>
<li>Encription &amp;&amp; Decription</li>
<li>Key Format</li>
<li>Use RSA</li>
</ul>
<span id="more"></span>
<h1 id="Intro"><a class="header-anchor" href="#Intro"></a>Intro</h1>
<p>RSA是最著名的公钥密码体制, 由三位美国科学家Rivest，Shamir和Adleman于1976年提出, 并在1978年正式发表. 它基于数论的大数分解问题.</p>
<p>我的<a target="_blank" rel="noopener" href="https://github.com/LYK-love/Lazy-Scripts/tree/master/SimpleRSA">RSA Python实现</a></p>
<h1 id="PrerequisiFtes"><a class="header-anchor" href="#PrerequisiFtes"></a>PrerequisiFtes</h1>
<h2 id="互质"><a class="header-anchor" href="#互质"></a>互质</h2>
<p>互质( coprime ): 如果两个正整数，除了 1 以外没有其他的公因数，则他们互质.</p>
<p>互质有如下结论:</p>
<ol>
<li>任意两个质数构成互质关系，比如13和61</li>
<li>若一个数是质数, 则两个数互质 == 另一个数不是前者的倍数</li>
<li>如果两个数之中，较大的那个数是质数，则两者构成互质关系，比如97和57。</li>
<li>1和任意一个自然数是都是互质关系，比如1和99。</li>
<li>p是大于1的整数，则p和p-1构成互质关系，比如57和56。</li>
<li>p是大于1的奇数，则p和p-2构成互质关系，比如17和15。</li>
</ol>
<h2 id="欧拉函数"><a class="header-anchor" href="#欧拉函数"></a>欧拉函数</h2>
<p>欧拉函数: 对于任意正整数$n$, 在小于等于n的正整数之中，与n构成互质关系的正整数个数为<br>
$$<br>
\phi(n) = n (1 - \frac{1}{p_1}) (1 - \frac{1}{p_2})…(1 - \frac{1}{p_n})<br>
$$<br>
其中, $p_i$表示 n 的不重复的质因子.</p>
<p>例如, $10 = 2 \times 5$，所以在 &lt;=10 的正整数中，与 10 互质的正整数个数为 4 个。我们可以验证一下，它们分别是 1, 3, 7, 9.</p>
<p>注意到, 如果$n$刚好是两个质数的积, 记为$n = pq$ , 则有$\phi(n) = pq(1 - \frac{1}{p})(1 - \frac{1}{q}) = (p-1)(q-1)$</p>
<h2 id="欧拉定理"><a class="header-anchor" href="#欧拉定理"></a>欧拉定理</h2>
<p>欧拉定理：如果两个正整数 $a$ 和 $n$ 互质, 则如下等式成立:<br>
$$<br>
a^{\phi(n)} \equiv 1 \pmod n<br>
$$<br>
注意到, 如果$p$为质数, 则有:<br>
$$<br>
\phi(p) = p - 1<br>
$$<br>
欧拉定理的证明比较复杂，这里就省略了.</p>
<p>例如, 7 和 10 互质, $7^{\phi(10)} = 7^4 = 2401$, 减去 1 等于 2400, 可以整除 10.</p>
<p>同理, $10^{\phi(7)} = 10^6 = 1000000$, 减去 1 等于 999999, 可以整除 7.</p>
<h2 id="费马小定理"><a class="header-anchor" href="#费马小定理"></a>费马小定理</h2>
<p>欧拉定理存在一个特殊情况：如果 $p$ 是质数，而 $a $ 不是 $p$ 的倍数，此时 $a$ 和 $p$ 必然互质. 因为$\phi(p) = p - 1$, 所以<br>
$$<br>
a^{\phi(p)} = a^{p - 1} \equiv 1 \pmod p<br>
$$<br>
这就是 <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-hans/%E8%B4%B9%E9%A9%AC%E5%B0%8F%E5%AE%9A%E7%90%86">费马小定理</a>,它是欧拉定理的特例.</p>
<h2 id="模反元素"><a class="header-anchor" href="#模反元素"></a>模反元素</h2>
<p>如果两个正整数 $a$ 和 $n$ 互质，那么一定可以找到一个正整数 $b$，使得 $ab - 1$ 被 $n$ 整除:<br>
$$<br>
ab \equiv 1 \mod n<br>
$$<br>
此时, $b$ 就叫做 $a$ 的 <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%A8%A1%E5%8F%8D%E5%85%83%E7%B4%A0">模反元素 </a>.</p>
<p>我们可以用欧拉定理来证明模反元素一定存在:<br>
$$<br>
a^{\phi(n)} = a \times a^{\phi(n) - 1} \equiv 1 \pmod n<br>
$$<br>
$a^{\phi(n) - 1}$就是 $a$ 相对 $n$ 的模反元素, 且 $a^{\phi(n) - 1} + kn, k \in N$ 也是 $a$ 相对 $n$ 的模反元素. 因此模反元素不唯一</p>
<h1 id="Key-Generation"><a class="header-anchor" href="#Key-Generation"></a>Key Generation</h1>
<ol>
<li>
<p>Choose two large prime numbers, $p$ and $q$ , then compute $n = pq$ . $p$ 和 $q$ 越大越好, 一般要求 $n$ 大于1024bit.</p>
</li>
<li>
<p>Compute  $z = \phi(n) = (p - 1)(q - 1)$</p>
</li>
<li>
<p>选择一个与 $z$ 互质的数 $e, e &gt; 1$</p>
<ul>
<li>The letter $e$ is used since this value will be used in encryption.</li>
<li>$e &gt; 1$: 因为后面要计算 $e$ 相对 $z$ 的模反元素, 如果$e = 1$, 则任何正整数都是$e$关于$n$d的模反元素, 也就导致 $d$ 可以取任何正整数, 算法很容易生成一个很简单的$d$ , $d$ 作为私钥就很容易被破解.</li>
</ul>
</li>
<li>
<p>计算 $e$ 相对 $z$ 的模反元素 $d$, 即使得 $ed \mod z = 1$, 即  $ed \equiv 1 \pmod {\phi(n)}$</p>
<ul>
<li>The letter $d$ is used because this value will be used in decryption.</li>
</ul>
</li>
<li>
<p>公钥就是$(n,e)$, 私钥就是$(n,d)$</p>
</li>
</ol>
<h2 id="计算模反元素-d"><a class="header-anchor" href="#计算模反元素-d"></a>计算模反元素 $d$</h2>
<p>前面已经知道, 如果两个正整数 $a$ 和 $n$ 互质, 则 $a$ 相对 $n$  的模反元素包括 $a^{\phi(n) - 1}$.  那么这里 $e$ 和 $z = {\phi(n)}$ 互质, 则模反元素$ d = e^{\phi(z) - 1} = e^{\phi({\phi(n)}) - 1}$ .</p>
<p>我们已经计算出了$z = \phi(n)$ , 它是个很大的数, 这意味着计算 $\phi[\phi(n)]$ 也很大, 导致$d = e^{\phi[\phi(n)]- 1}$是一个很高很高的幂次, 运算复杂度无法接受. 因此要换个方法求$d$</p>
<p>因为:<br>
$$<br>
ed \equiv 1 \pmod {\phi(n)}<br>
$$<br>
得到:<br>
$$<br>
ed = k\phi(n) + 1<br>
$$<br>
移项得到:<br>
$$<br>
ed - k\phi(n) = 1<br>
$$<br>
所以，这个问题转化为：已知两个数 a 和 b，求解 x 和 y 满足如下方程：<br>
$$<br>
ax + by = 1<br>
$$<br>
( $a = e, b = \phi(n)=z, x = d, y = -k$ )</p>
<p>根据 <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E6%89%A9%E5%B1%95%E6%AC%A7%E5%87%A0%E9%87%8C%E5%BE%97%E7%AE%97%E6%B3%95">扩展欧几里得算法</a>，这个方程有解的充分必要条件是 a 和 b 互质.</p>
<p>在我们的情况中，$e$ 和 $\phi(n)$ 是互质的，所以这个方程式有解. 同时，通过扩展欧几里得算法，可以非常容易的通过迭代求解出$d$ .</p>
<h1 id="Encription-Decription"><a class="header-anchor" href="#Encription-Decription"></a>Encription &amp;&amp; Decription</h1>
<ol>
<li>
<p>被加密的消息 $m$ 是一个整数( 将字符编码为整数 ), <strong>满足 $ m &lt; n $</strong> . 如果消息太大，解读为整数以后比 n 要大，那么分段加密即可.</p>
<p>加密过程使用 $e$ , 计算密文 $c$ :<br>
$$<br>
c \equiv m^e \pmod n<br>
$$</p>
</li>
<li>
<p>解密过程使用$d$, 计算明文 $m$ :<br>
$$<br>
m \equiv c^d \pmod n<br>
$$</p>
</li>
</ol>
<p>注意到加密函数$E_{(n,e)}(m)  \equiv m^e \pmod n $,  解密函数$D_{(n,d)}(c)  \equiv m^d \pmod n $, 它们其实是一个函数在形式上都是:<br>
$$<br>
f(m, n, e) \equiv m^e \pmod n<br>
$$</p>
<p>只是加密和解密时接受的参数不同.</p>
<h2 id="Example"><a class="header-anchor" href="#Example"></a>Example</h2>
<p>因为加密的消息 m 必须要小于 n, 并且计算密文$c \equiv m^e \pmod n$ 需要求幂, 这是个昂贵的操作. 因此在实践中, 我们不会用RSA来直接加密消息, 而是用它来加密一个对称密钥( 称为<strong>session key</strong> ), 用session key来加密消息.</p>
<p>举例来说, 假如Alice要和Bob加密通讯, 步骤为:</p>
<ol>
<li>Alice选择一个session key, 记为$K_S$</li>
<li>Alice把session key用Bob的公钥加密, 即计算$(K_S)^e$, 并发送给Bob</li>
<li>Bob收到后, 计算明文$K_S \equiv c^d \pmod n$ , 得到了$K_S$ , 现在Bog知道了共享密钥$K_S$</li>
<li>Alice和Bob然后通过$K_S$进行对称加密通信, 当然他们实现肯定约定好了对称加密算法AES/DES</li>
</ol>
<p>当然直接用RSA加密消息也是可以的, 下面演示Alice与Bob采用RSA明文加密的通信步骤</p>
<table>
<thead>
<tr>
<th>Ciphertext $c$</th>
<th>$c^d$</th>
<th>$m = c^d \pmod n$</th>
<th>Plaintext Letter</th>
</tr>
</thead>
<tbody>
<tr>
<td>17</td>
<td>4819685721067509 150915091411825223071697</td>
<td>248832</td>
<td>l</td>
</tr>
<tr>
<td>15</td>
<td>127834039403948858939111232757568359375</td>
<td>15</td>
<td>o</td>
</tr>
<tr>
<td>22</td>
<td>851643319086537701956194499721106030592</td>
<td>22</td>
<td>v</td>
</tr>
<tr>
<td>10</td>
<td>1000000000000000000000000000000</td>
<td>5</td>
<td>e</td>
</tr>
</tbody>
</table>
<p>Alice’s RSA encryption, $e$ = 5, $n = 35$</p>
<table>
<thead>
<tr>
<th>Plaintext Letter</th>
<th>$m$: numeric representation</th>
<th>$m^e$</th>
<th>Ciphertext $c \equiv m^e \pmod n$</th>
</tr>
</thead>
<tbody>
<tr>
<td>l</td>
<td>12</td>
<td>248832</td>
<td>17</td>
</tr>
<tr>
<td>o</td>
<td>15</td>
<td>759375</td>
<td>15</td>
</tr>
<tr>
<td>v</td>
<td>22</td>
<td>5153632</td>
<td>22</td>
</tr>
<tr>
<td>e</td>
<td>5</td>
<td>3125</td>
<td>10</td>
</tr>
</tbody>
</table>
<p>Bob’s RSA decryption, $d$= 29, $n$ = 35</p>
<h2 id="Proof"><a class="header-anchor" href="#Proof"></a>Proof</h2>
<p>下面证明该式:<br>
$$<br>
\begin{equation}\label{eq1}<br>
c^d \equiv m \pmod n<br>
\end{equation}<br>
$$</p>
<p>Proof:<br>
$$<br>
\because<br>
m^e \equiv c \pmod n<br>
\<br>
\therefore<br>
c = m^e - kn<br>
$$<br>
将 $c$ 代入$\eqref{eq1}$:<br>
$$<br>
(m^e - kn)^d \equiv m \pmod n<br>
$$</p>
<p>根据 <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E4%BA%8C%E9%A1%B9%E5%BC%8F%E5%AE%9A%E7%90%86">二项式定理</a>，左边展开后的每一项，除$m^{ed}$以外, 都含有$kn$, 因此, 证明上面的式子<strong>等同于证明</strong>:<br>
$$<br>
\begin{equation}\label{eq2}<br>
m^{ed} \equiv m \pmod n<br>
\end{equation}<br>
$$</p>
<p>注意到:<br>
$$<br>
\because<br>
ed \equiv 1 \pmod {\phi(n)}<br>
$$</p>
<p>$$<br>
\therefore ed = 1 + h\phi(n), h \in N<br>
$$<br>
代入$\eqref{eq2}$得到:<br>
$$<br>
\begin{equation}\label{eq3}<br>
m^{h\phi(n) + 1} \equiv m \pmod n<br>
\end{equation}<br>
$$<br>
我们要证明$\eqref{eq3}$.</p>
<p>接下来分类讨论:</p>
<ol>
<li>
<p>如果 m 和 n 互质.</p>
<p>根据欧拉定理:<br>
$$<br>
m^{\phi(n)} \equiv 1 \pmod n<br>
$$<br>
所以:<br>
$$<br>
\begin{align}<br>
m^{\phi(n)} = kn + 1, n \in N \nonumber \<br>
(m^{\phi(n)})^h = (kn + 1)^h, h \in N \nonumber<br>
\end{align}<br>
$$</p>
<p>根据二项式定理得到:<br>
$$<br>
(kn + 1)^h = (kn)^h + \complement_h^1 (kn)^{h-1} + \dots + \complement_h^{h-1} (kn) + 1<br>
$$<br>
let $k' = k^hn^{h-1} + \complement_h^1 k^{h-1}n^{h-2} + \dots$ , 得到:<br>
$$<br>
(m^{\phi(n)})^h = k’n + 1, k' \in N<br>
$$</p>
<p>也就是:<br>
$$<br>
(m^{\phi(n)})^h \equiv 1 \pmod n<br>
$$<br>
从而:<br>
$$<br>
(m^{\phi(n)})^h \times m \equiv m \pmod n<br>
$$<br>
也就是:<br>
$$<br>
m^{h \phi(n) + 1 } \equiv m \pmod n<br>
$$<br>
前面已经得到:<br>
$$<br>
ed = 1 + h\phi(n)<br>
$$<br>
所以有:<br>
$$<br>
m^{ed} \equiv m \pmod n<br>
$$</p>
<p>Q.E.D.</p>
</li>
<li>
<p>如果 $m$ 和 $n$ 不互质.</p>
<p>因为 $n$ 是质数 $p$ 和 $q$ 的乘积，<strong>此时 $m$ 必然为 $kp$ 或 $hq$</strong> ( $k,h \in N^+$ )[^1]</p>
<p>以 $m = kp$ 为例, 因为 $m &lt; n$ , 所以 $m = kp &lt; n = pq$，所以 $k &lt; q$ , 而 $q$ 是一个质数, 小于 $q$ 的所有数都与 $q$ 互质, 所以 $k$ 与 $q$ 互质.</p>
<p>同时 $kp$ 必然也与 $q$ 互质. 我们用反证法: 如果 $kp$ 和 $q$ 不互质, <strong>则 $kp$ 必然是 $q$ 的倍数</strong>[^2]. 现在 $m = kp $ 既是 $p$ 的倍数又是 $q$ 的倍数, $p, q$ 又是质数, 则 $ m = kp $ 是 $n = pq$ 的倍数, 与前提 $m &lt; n$  矛盾. 因此 $kp$ 与$q$互质.</p>
<p>由于 $kp$ 和 $q$ 互质，根据欧拉定理:<br>
$$<br>
(kp)^{q - 1} \equiv 1 \pmod q<br>
$$<br>
所以:<br>
$$<br>
(kp)^{q - 1} = tq + 1<br>
$$<br>
两边同时进行 $h(p-1)$ 次方:<br>
$$<br>
[(kp)^{q - 1}]^{h(p-1)} = (tq + 1)^{h(p-1)}<br>
$$<br>
同理根据二项式定理，右边展开除了 1 , 每一项都含有$ q$，所以得到:<br>
$$<br>
[(kp)^{q - 1}]^{h(p-1)} \equiv 1 \pmod q<br>
$$<br>
从而得到:<br>
$$<br>
[(kp)^{q - 1}]^{h(p-1)} \times kp \equiv kp \pmod q<br>
$$<br>
注意到:<br>
$$<br>
\begin{align}<br>
n = pq \nonumber \<br>
\phi(n) = n(1 - \frac{1}{p})(1 - \frac{1}{q}) == (p-1)(q-1) \nonumber<br>
\end{align}<br>
$$</p>
<p>所以:<br>
$$<br>
[(kp)^{q - 1}]^{h(p-1)} \times kp = (kp)^{h\phi(n) + 1}<br>
$$<br>
前面已经得到:<br>
$$<br>
ed = 1 + h\phi(n)<br>
$$<br>
所以有:<br>
$$<br>
(kp)^{ed} \equiv kp \pmod q<br>
$$<br>
再改写为如下形式:<br>
$$<br>
(kp)^{ed} = kp + tq<br>
$$<br>
左边 $(kp)^{ed}$ 是  $p$ 的倍数，右边 $kp$ 是 $p$ 的倍数，所以 $tq$ 必然是 $p$ 的倍数。而 $q$ 是 $p$ 互质的，因此 $t$ 必然是 $p$ 的倍数，我们记为 $t = t’p$ , 代入得到:<br>
$$<br>
(kp)^{ed} = kp + t’pq<br>
$$<br>
也就是:<br>
$$<br>
m^{ed} \equiv m \pmod n<br>
$$</p>
<p>Q.E.D</p>
</li>
</ol>
<h1 id="Reliability"><a class="header-anchor" href="#Reliability"></a>Reliability</h1>
<p>接下来我们来看为什么 RSA 是可靠的，也就是说，在得知公钥 $[n, e]$ 的情况下，怎样保证私钥 $[n,d]$ 的安全。</p>
<p>因为 $n$ 和 $e$ 是公开的，所以私钥的安全就是 $d$ 的安全，那么有没有可能在得知 $n$ 和 $e$ 的情况下，推导得出 $d$ ？</p>
<ul>
<li>因为 $ed \equiv 1 \pmod {\phi(n)}$ , 想知道 $d$ 需要知道 $e$ 和 $\phi(n)$</li>
<li>因为 $e$ 是公开的，所以想知道 $d$ 需要知道 $\phi(n) $</li>
<li>而 计算 $\phi(n) $ 需要对正整数 $n$ 进行质数分解</li>
</ul>
<p>所以， <strong>$d$ 的安全性依赖于对  $n$ 进行质数分解的难度</strong>. 大整数的质数分解目前没有很快的算法.  但是,随着量子计算的发展, RSA也不一定安全[MIT TR 2019].</p>
<h1 id="Key-Format"><a class="header-anchor" href="#Key-Format"></a>Key Format</h1>
<p>以下内容摘抄自https://cjting.me/2020/03/13/rsa/</p>
<p>我们现在来生成一对RSA秘钥看看他们的格式是怎样的，上面的几个关键数字 n, e, d 又是怎样保存的。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ssh-keygen -f rsa</span><br></pre></td></tr></table></figure>
<p>我们得到了 <code>rsa</code> 和 <code>rsa.pub</code> 文件，其中 <code>rsa</code> 是私钥，<code>rsa.pub</code> 是公钥。</p>
<p>先来看公钥，<code>rsa.pub</code> 的内容如下。</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDMIcdbPh0r8kftRomVX4+6HkCoZYYoWPvI7AQvcEvanZl+j2AqWEFoC8zHMXqXLlMPeE5Nt0tzLFixw9sKOhA3llc2CL4B3cJaYQ1GHI6bpSX1U1PkBtm1YaIMR+d/r22o5On/U0B4Zkmo5Ua+XI3yeYqkyCLgRWz1832IIl9dVvNSln9R89Ox1XOvuMxNnEeACcSBmnAGvY5Jykhf4TBDwwNRmqZpusqkpkfhA6Y9PvjbRNMfcDEz82VV1VeLxIg3ayC6MX5I4vXFORIzx+VbBnxwing8vQZAHj0lFNmWeOZzoh3o9k4uFCSzWezVQD9JV9xQorjsZ5AB1Zdqb1J5 cj@CJs-MacBook-Pro.local</span><br></pre></td></tr></table></figure>
<p>这个格式是 OpenSSH 公钥格式，<a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc4253#section-6.6">RFC4253</a> 中有详细的说明。简单来说，公钥分为三个部分</p>
<ul>
<li>秘钥类型：<code>ssh-rsa</code></li>
<li>PEM 编码的一段数据：<code>AAAA..b1J5</code></li>
<li>备注：<code>cj@CJs-Macbook-Pro.local</code></li>
</ul>
<p>PEM 的全称是 <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Base64#Privacy-enhanced_mail">Privacy Enhanced Mail</a>，是一种 Base64 编码，使用 ASCII 来编码二进制数据。</p>
<p>PEM 编码的数据是三个 <code>(length, data)</code> 数据块，<code>length</code> 为四个字节，BigEndian.</p>
<ul>
<li>第一个 data 表示秘钥类型，和公钥第一部分相同</li>
<li>第二个 data 为 RSA exponent，也就是 $e$</li>
<li>第三个 data 为 RSA modulus，也就是 $n$</li>
</ul>
<p>根据上面的知识，我们可以很容易地解析 <code>rsa.pub</code> 文件，下文中提到的 <code>rsademo</code> 程序实现了公钥解析的逻辑。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ rsademo -parse rsa.pub</span><br><span class="line">OpenSSH Public Key</span><br><span class="line">  algorithm: ssh-rsa</span><br><span class="line">  e: 0x010001</span><br><span class="line">  n: 0xCC21C75B3E1D2BF247ED4689955F8FBA1E40A865862858FBC8EC042F704BDA9D997E8F602A5841680BCCC7317A972E530F784E4DB74B732C58B1C3DB0A3A103796573608BE01DDC25A610D461C8E9BA525F55353E406D9B561A20C47E77FAF6DA8E4E9FF5340786649A8E546BE5C8DF2798AA4C822E0456CF5F37D88225F5D56F352967F51F3D3B1D573AFB8CC4D9C478009C4819A7006BD8E49CA485FE13043C303519AA669BACAA4A647E103A63D3EF8DB44D31F703133F36555D5578BC488376B20BA317E48E2F5C5391233C7E55B067C708A783CBD06401E3D2514D99678E673A21DE8F64E2E1424B359ECD5403F4957DC50A2B8EC679001D5976A6F5279</span><br></pre></td></tr></table></figure>
<p>我们也可以使用 <code>openssl</code> 来解析。因为公钥是 OpenSSH 的格式，需要先转换到标准的 PEM 格式。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ssh-keygen -e -m PEM -f rsa.pub | openssl asn1parse -inform PEM</span><br><span class="line">    0:d=0  hl=4 l= 266 cons: SEQUENCE</span><br><span class="line">    4:d=1  hl=4 l= 257 prim: INTEGER           :CC21C75B3E1D2BF247ED4689955F8FBA1E40A865862858FBC8EC042F704BDA9D997E8F602A5841680BCCC7317A972E530F784E4DB74B732C58B1C3DB0A3A103796573608BE01DDC25A610D461C8E9BA525F55353E406D9B561A20C47E77FAF6DA8E4E9FF5340786649A8E546BE5C8DF2798AA4C822E0456CF5F37D88225F5D56F352967F51F3D3B1D573AFB8CC4D9C478009C4819A7006BD8E49CA485FE13043C303519AA669BACAA4A647E103A63D3EF8DB44D31F703133F36555D5578BC488376B20BA317E48E2F5C5391233C7E55B067C708A783CBD06401E3D2514D99678E673A21DE8F64E2E1424B359ECD5403F4957DC50A2B8EC679001D5976A6F5279</span><br><span class="line">  265:d=1  hl=2 l=   3 prim: INTEGER           :010001</span><br></pre></td></tr></table></figure>
<p>可以很容易地看出第一个数字是 n，第二个数字是 e，都是十六进制的表达方式。</p>
<p>私钥的内容如下。</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">-----BEGIN OPENSSH PRIVATE KEY-----</span><br><span class="line">b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn</span><br><span class="line">NhAAAAAwEAAQAAAQEAzCHHWz4dK/JH7UaJlV+Puh5AqGWGKFj7yOwEL3BL2p2Zfo9gKlhB</span><br><span class="line">aAvMxzF6ly5TD3hOTbdLcyxYscPbCjoQN5ZXNgi+Ad3CWmENRhyOm6Ul9VNT5AbZtWGiDE</span><br><span class="line">fnf69tqOTp/1NAeGZJqOVGvlyN8nmKpMgi4EVs9fN9iCJfXVbzUpZ/UfPTsdVzr7jMTZxH</span><br><span class="line">gAnEgZpwBr2OScpIX+EwQ8MDUZqmabrKpKZH4QOmPT7420TTH3AxM/NlVdVXi8SIN2sguj</span><br><span class="line">F+SOL1xTkSM8flWwZ8cIp4PL0GQB49JRTZlnjmc6Id6PZOLhQks1ns1UA/SVfcUKK47GeQ</span><br><span class="line">AdWXam9SeQAAA9B/9/tPf/f7TwAAAAdzc2gtcnNhAAABAQDMIcdbPh0r8kftRomVX4+6Hk</span><br><span class="line">CoZYYoWPvI7AQvcEvanZl+j2AqWEFoC8zHMXqXLlMPeE5Nt0tzLFixw9sKOhA3llc2CL4B</span><br><span class="line">3cJaYQ1GHI6bpSX1U1PkBtm1YaIMR+d/r22o5On/U0B4Zkmo5Ua+XI3yeYqkyCLgRWz183</span><br><span class="line">2IIl9dVvNSln9R89Ox1XOvuMxNnEeACcSBmnAGvY5Jykhf4TBDwwNRmqZpusqkpkfhA6Y9</span><br><span class="line">PvjbRNMfcDEz82VV1VeLxIg3ayC6MX5I4vXFORIzx+VbBnxwing8vQZAHj0lFNmWeOZzoh</span><br><span class="line">3o9k4uFCSzWezVQD9JV9xQorjsZ5AB1Zdqb1J5AAAAAwEAAQAAAQEAiC1gmPXu8ApJAXk0</span><br><span class="line">/3kooLjd2Xkg7nmuPnN0t1DqyYSpiUyMkrMdrxNwINJZPdGhh4hydFX693J2GODXlxL1Dq</span><br><span class="line">A0vc9HMmeF6FUmTcdvO1YI5IgaRtxrEB15xUeSoBOfzDQqBjK7p5ZVPV72urdz2nZKj3MU</span><br><span class="line">ERk/fzRYYiDMDa9o4frPay3vc2NLSjqbrpFXTHGBYGpVoIY1R7awczBILIz+TqVZ0Awlpp</span><br><span class="line">89aU3K9K4Sbgnb6p0dcGD8FLoRI5geviLOwYbAnuELxzMrJSVC4xH6UMiLGGqm07qpB3cx</span><br><span class="line">Dd2M6jW1179bNko5qHnbsi87SYO5ms+3mRnin6I08kBogQAAAIEAlAGXHrG3+L73gXfK74</span><br><span class="line">8qoC//E97EdtjPZImAr4Ess62TTfOi3SBungRvmXtWY9s/gkimZa6BL2elyEWlwlLlllX2</span><br><span class="line">jZLbLDjRbGdEmjEwIlzF6Dlkv5EiuGzzJ06MirVuOVpWSgtI3GL+Ir8ovibHq+zz7MGPMQ</span><br><span class="line">dsqqASDZXvPn8AAACBAP/frz0gP1YC6w1ZPIcNCFgcWqfKofSwQviZGthpk04ZwwCkNu2X</span><br><span class="line">sG61MqhnsrUt2vJhMtB0khboXa1SxHO6og5duCH2Tn8uWlZsTiFAjhqOxuZwaCd2f+1tgc</span><br><span class="line">4SUpIdavJrkeLLUM+7JprdUeqGGrv9ae5vtfhEBozbwDGm3CJFAAAAgQDMO487OesMXGh2</span><br><span class="line">p2WES/pw+LxJuFqtZZY8Oy2uBNJKXNeFWXioiL4EglMLBgPz5zFkg73qMF2cTP/XFSiO8z</span><br><span class="line">q6LUJOy6FnKDPF8eo5jkaIjyLK3ue9BjF79AB2vkB5APSwNBS6Q5sryKqlaT1u3mx+45FZ</span><br><span class="line">HLB/Zl4iDn404UoMpQAAABhjakBDSnMtTWFjQm9vay1Qcm8ubG9jYWwB</span><br><span class="line">-----END OPENSSH PRIVATE KEY-----</span><br></pre></td></tr></table></figure>
<p>我并没有找到标准的格式说明文档，不过这篇博客 <a target="_blank" rel="noopener" href="https://coolaj86.com/articles/the-openssh-private-key-format/">The OpenSSH Private Key Format</a> 写的很清楚，我验证了一下，是对的。</p>
<p>简单来说，除去开头和结尾的 Marker，中间部分是 Base64 编码的一段数据，数据格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;openssh-key-v1&quot;0x00    # NULL-terminated &quot;Auth Magic&quot; string</span><br><span class="line">32-bit length, &quot;none&quot;   # ciphername length and string</span><br><span class="line">32-bit length, &quot;none&quot;   # kdfname length and string</span><br><span class="line">32-bit length, nil      # kdf (0 length, no kdf)</span><br><span class="line">32-bit 0x01             # number of keys, hard-coded to 1 (no length)</span><br><span class="line">32-bit length, sshpub   # public key in ssh format</span><br><span class="line">    32-bit length, keytype</span><br><span class="line">    32-bit length, pub0</span><br><span class="line">    32-bit length, pub1</span><br><span class="line">32-bit length for rnd+prv+comment+pad</span><br><span class="line">    64-bit dummy checksum?  # a random 32-bit int, repeated</span><br><span class="line">    32-bit length, keytype  # the private key (including public)</span><br><span class="line">    32-bit length, pub0     # Public Key parts</span><br><span class="line">    32-bit length, pub1</span><br><span class="line">    32-bit length, prv0     # Private Key parts</span><br><span class="line">    ...                     # (number varies by type)</span><br><span class="line">    32-bit length, comment  # comment string</span><br><span class="line">    padding bytes 0x010203  # pad to blocksize (see notes below)</span><br></pre></td></tr></table></figure>
<p>根据上面的描述，我们会发现，其实私钥文件中完整编码了公钥的信息，所以通过私钥我们可以很容易地“恢复”出公钥文件。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ssh-keygen -y -f rsa</span><br><span class="line">ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDMIcdbPh0r8kftRomVX4+6HkCoZYYoWPvI7AQvcEvanZl+j2AqWEFoC8zHMXqXLlMPeE5Nt0tzLFixw9sKOhA3llc2CL4B3cJaYQ1GHI6bpSX1U1PkBtm1YaIMR+d/r22o5On/U0B4Zkmo5Ua+XI3yeYqkyCLgRWz1832IIl9dVvNSln9R89Ox1XOvuMxNnEeACcSBmnAGvY5Jykhf4TBDwwNRmqZpusqkpkfhA6Y9PvjbRNMfcDEz82VV1VeLxIg3ayC6MX5I4vXFORIzx+VbBnxwing8vQZAHj0lFNmWeOZzoh3o9k4uFCSzWezVQD9JV9xQorjsZ5AB1Zdqb1J5</span><br></pre></td></tr></table></figure>
<p>有了结构说明，就不难自己实现解析器了。同样，下文的 <code>rsademo</code> 程序实现了私钥的解析逻辑。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ rsademo -parse rsa</span><br><span class="line">OpenSSH Private Key</span><br><span class="line">  keyType: ssh-rsa</span><br><span class="line">  n: 0xCC21C75B3E1D2BF247ED4689955F8FBA1E40A865862858FBC8EC042F704BDA9D997E8F602A5841680BCCC7317A972E530F784E4DB74B732C58B1C3DB0A3A103796573608BE01DDC25A610D461C8E9BA525F55353E406D9B561A20C47E77FAF6DA8E4E9FF5340786649A8E546BE5C8DF2798AA4C822E0456CF5F37D88225F5D56F352967F51F3D3B1D573AFB8CC4D9C478009C4819A7006BD8E49CA485FE13043C303519AA669BACAA4A647E103A63D3EF8DB44D31F703133F36555D5578BC488376B20BA317E48E2F5C5391233C7E55B067C708A783CBD06401E3D2514D99678E673A21DE8F64E2E1424B359ECD5403F4957DC50A2B8EC679001D5976A6F5279</span><br><span class="line">  e: 0x010001</span><br><span class="line">  d: 0x882D6098F5EEF00A49017934FF7928A0B8DDD97920EE79AE3E7374B750EAC984A9894C8C92B31DAF137020D2593DD1A18788727455FAF7727618E0D79712F50EA034BDCF47326785E855264DC76F3B5608E4881A46DC6B101D79C54792A0139FCC342A0632BBA796553D5EF6BAB773DA764A8F731411193F7F34586220CC0DAF68E1FACF6B2DEF73634B4A3A9BAE91574C7181606A55A0863547B6B07330482C8CFE4EA559D00C25A69F3D694DCAF4AE126E09DBEA9D1D7060FC14BA1123981EBE22CEC186C09EE10BC7332B252542E311FA50C88B186AA6D3BAA90777310DDD8CEA35B5D7BF5B364A39A879DBB22F3B4983B99ACFB79919E29FA234F2406881</span><br><span class="line">  p: 0xFFDFAF3D203F5602EB0D593C870D08581C5AA7CAA1F4B042F8991AD869934E19C300A436ED97B06EB532A867B2B52DDAF26132D0749216E85DAD52C473BAA20E5DB821F64E7F2E5A566C4E21408E1A8EC6E6706827767FED6D81CE1252921D6AF26B91E2CB50CFBB269ADD51EA861ABBFD69EE6FB5F844068CDBC031A6DC2245</span><br><span class="line">  q: 0xCC3B8F3B39EB0C5C6876A765844BFA70F8BC49B85AAD65963C3B2DAE04D24A5CD7855978A888BE0482530B0603F3E7316483BDEA305D9C4CFFD715288EF33ABA2D424ECBA1672833C5F1EA398E46888F22CADEE7BD06317BF40076BE407900F4B03414BA439B2BC8AAA5693D6EDE6C7EE391591CB07F665E220E7E34E14A0CA5</span><br></pre></td></tr></table></figure>
<p>如果使用 <code>openssl</code> 的话，可以通过如下指令解析私钥。<code>ssh-keygen</code> 无法直接更改私钥的格式，需要曲线救国，使用它“修改密码”的功能，参考 <a target="_blank" rel="noopener" href="https://unix.stackexchange.com/questions/84060/convert-openssh-private-key-into-ssh2-private-key">这个提问</a>。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cp</span> rsa rsa.pem</span><br><span class="line">$ ssh-keygen -p -m PEM -f rsa.pem</span><br><span class="line">$ <span class="built_in">cat</span> rsa.pem</span><br><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">MIIEpQIBAAKCAQEAzCHHWz4dK/JH7UaJlV+Puh5AqGWGKFj7yOwEL3BL2p2Zfo9g</span><br><span class="line">KlhBaAvMxzF6ly5TD3hOTbdLcyxYscPbCjoQN5ZXNgi+Ad3CWmENRhyOm6Ul9VNT</span><br><span class="line">5AbZtWGiDEfnf69tqOTp/1NAeGZJqOVGvlyN8nmKpMgi4EVs9fN9iCJfXVbzUpZ/</span><br><span class="line">UfPTsdVzr7jMTZxHgAnEgZpwBr2OScpIX+EwQ8MDUZqmabrKpKZH4QOmPT7420TT</span><br><span class="line">H3AxM/NlVdVXi8SIN2sgujF+SOL1xTkSM8flWwZ8cIp4PL0GQB49JRTZlnjmc6Id</span><br><span class="line">6PZOLhQks1ns1UA/SVfcUKK47GeQAdWXam9SeQIDAQABAoIBAQCILWCY9e7wCkkB</span><br><span class="line">eTT/eSiguN3ZeSDuea4+c3S3UOrJhKmJTIySsx2vE3Ag0lk90aGHiHJ0Vfr3cnYY</span><br><span class="line">4NeXEvUOoDS9z0cyZ4XoVSZNx287VgjkiBpG3GsQHXnFR5KgE5/MNCoGMrunllU9</span><br><span class="line">Xva6t3PadkqPcxQRGT9/NFhiIMwNr2jh+s9rLe9zY0tKOpuukVdMcYFgalWghjVH</span><br><span class="line">trBzMEgsjP5OpVnQDCWmnz1pTcr0rhJuCdvqnR1wYPwUuhEjmB6+Is7BhsCe4QvH</span><br><span class="line">MyslJULjEfpQyIsYaqbTuqkHdzEN3YzqNbXXv1s2SjmoeduyLztJg7maz7eZGeKf</span><br><span class="line">ojTyQGiBAoGBAP/frz0gP1YC6w1ZPIcNCFgcWqfKofSwQviZGthpk04ZwwCkNu2X</span><br><span class="line">sG61MqhnsrUt2vJhMtB0khboXa1SxHO6og5duCH2Tn8uWlZsTiFAjhqOxuZwaCd2</span><br><span class="line">f+1tgc4SUpIdavJrkeLLUM+7JprdUeqGGrv9ae5vtfhEBozbwDGm3CJFAoGBAMw7</span><br><span class="line">jzs56wxcaHanZYRL+nD4vEm4Wq1lljw7La4E0kpc14VZeKiIvgSCUwsGA/PnMWSD</span><br><span class="line">veowXZxM/9cVKI7zOrotQk7LoWcoM8Xx6jmORoiPIsre570GMXv0AHa+QHkA9LA0</span><br><span class="line">FLpDmyvIqqVpPW7ebH7jkVkcsH9mXiIOfjThSgylAoGBANSTUnQXCWd8zyjs3TNZ</span><br><span class="line">6XfCPrKtzvWJRmpgUIRA2eeF0ZMD2rpzTln7YdW1KSwKp568j8nNPt2XONRZMerv</span><br><span class="line">v9jtlZ9pkPdqXBT2r8ZCaoy315j1BCLc+RUY6EF6yWyo0gQKyE3CGiYq1rzMaFTO</span><br><span class="line">CwHpXAuCdYyHf2Wg38CgXrx9AoGAHvN3xXYFlR38Bt9flykcjzpi7pktxNF8byxY</span><br><span class="line">w+KfK/3d+6uPiZsPkQdfJnCG8NO8vIrqoS8rQKC6tRHTz7Y01Do/rklV8Jg7IGiF</span><br><span class="line">IqvZLKDkmPInFJJ3tV1JJLW4d54ZdwqtiXztazlCA0drs/2pW6GJSYP7i5Mr+OVR</span><br><span class="line">YxoxarECgYEAlAGXHrG3+L73gXfK748qoC//E97EdtjPZImAr4Ess62TTfOi3SBu</span><br><span class="line">ngRvmXtWY9s/gkimZa6BL2elyEWlwlLlllX2jZLbLDjRbGdEmjEwIlzF6Dlkv5Ei</span><br><span class="line">uGzzJ06MirVuOVpWSgtI3GL+Ir8ovibHq+zz7MGPMQdsqqASDZXvPn8=</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure>
<p>得到 PEM 格式的私钥以后，剩下就好办了。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ openssl asn1parse -inform PEM &lt; rsa.pem</span><br><span class="line">    0:d=0  hl=4 l=1189 cons: SEQUENCE</span><br><span class="line">    4:d=1  hl=2 l=   1 prim: INTEGER           :00</span><br><span class="line">    7:d=1  hl=4 l= 257 prim: INTEGER           :CC21C75B3E1D2BF247ED4689955F8FBA1E40A865862858FBC8EC042F704BDA9D997E8F602A5841680BCCC7317A972E530F784E4DB74B732C58B1C3DB0A3A103796573608BE01DDC25A610D461C8E9BA525F55353E406D9B561A20C47E77FAF6DA8E4E9FF5340786649A8E546BE5C8DF2798AA4C822E0456CF5F37D88225F5D56F352967F51F3D3B1D573AFB8CC4D9C478009C4819A7006BD8E49CA485FE13043C303519AA669BACAA4A647E103A63D3EF8DB44D31F703133F36555D5578BC488376B20BA317E48E2F5C5391233C7E55B067C708A783CBD06401E3D2514D99678E673A21DE8F64E2E1424B359ECD5403F4957DC50A2B8EC679001D5976A6F5279</span><br><span class="line">  268:d=1  hl=2 l=   3 prim: INTEGER           :010001</span><br><span class="line">  273:d=1  hl=4 l= 257 prim: INTEGER           :882D6098F5EEF00A49017934FF7928A0B8DDD97920EE79AE3E7374B750EAC984A9894C8C92B31DAF137020D2593DD1A18788727455FAF7727618E0D79712F50EA034BDCF47326785E855264DC76F3B5608E4881A46DC6B101D79C54792A0139FCC342A0632BBA796553D5EF6BAB773DA764A8F731411193F7F34586220CC0DAF68E1FACF6B2DEF73634B4A3A9BAE91574C7181606A55A0863547B6B07330482C8CFE4EA559D00C25A69F3D694DCAF4AE126E09DBEA9D1D7060FC14BA1123981EBE22CEC186C09EE10BC7332B252542E311FA50C88B186AA6D3BAA90777310DDD8CEA35B5D7BF5B364A39A879DBB22F3B4983B99ACFB79919E29FA234F2406881</span><br><span class="line">  534:d=1  hl=3 l= 129 prim: INTEGER           :FFDFAF3D203F5602EB0D593C870D08581C5AA7CAA1F4B042F8991AD869934E19C300A436ED97B06EB532A867B2B52DDAF26132D0749216E85DAD52C473BAA20E5DB821F64E7F2E5A566C4E21408E1A8EC6E6706827767FED6D81CE1252921D6AF26B91E2CB50CFBB269ADD51EA861ABBFD69EE6FB5F844068CDBC031A6DC2245</span><br><span class="line">  666:d=1  hl=3 l= 129 prim: INTEGER           :CC3B8F3B39EB0C5C6876A765844BFA70F8BC49B85AAD65963C3B2DAE04D24A5CD7855978A888BE0482530B0603F3E7316483BDEA305D9C4CFFD715288EF33ABA2D424ECBA1672833C5F1EA398E46888F22CADEE7BD06317BF40076BE407900F4B03414BA439B2BC8AAA5693D6EDE6C7EE391591CB07F665E220E7E34E14A0CA5</span><br><span class="line">  798:d=1  hl=3 l= 129 prim: INTEGER           :D49352741709677CCF28ECDD3359E977C23EB2ADCEF589466A60508440D9E785D19303DABA734E59FB61D5B5292C0AA79EBC8FC9CD3EDD9738D45931EAEFBFD8ED959F6990F76A5C14F6AFC6426A8CB7D798F50422DCF91518E8417AC96CA8D2040AC84DC21A262AD6BCCC6854CE0B01E95C0B82758C877F65A0DFC0A05EBC7D</span><br><span class="line">  930:d=1  hl=3 l= 128 prim: INTEGER           :1EF377C57605951DFC06DF5F97291C8F3A62EE992DC4D17C6F2C58C3E29F2BFDDDFBAB8F899B0F91075F267086F0D3BCBC8AEAA12F2B40A0BAB511D3CFB634D43A3FAE4955F0983B20688522ABD92CA0E498F227149277B55D4924B5B8779E19770AAD897CED6B394203476BB3FDA95BA1894983FB8B932BF8E551631A316AB1</span><br><span class="line"> 1061:d=1  hl=3 l= 129 prim: INTEGER           :9401971EB1B7F8BEF78177CAEF8F2AA02FFF13DEC476D8CF648980AF812CB3AD934DF3A2DD206E9E046F997B5663DB3F8248A665AE812F67A5C845A5C252E59655F68D92DB2C38D16C67449A3130225CC5E83964BF9122B86CF3274E8C8AB56E395A564A0B48DC62FE22BF28BE26C7ABECF3ECC18F31076CAAA0120D95EF3E7F</span><br></pre></td></tr></table></figure>
<p>我们得到了一堆数字，对照如下的说明，就可以知道每个数字的含义。</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">RSAPrivateKey ::= SEQUENCE &#123;</span><br><span class="line">    version           Version,</span><br><span class="line">    modulus           INTEGER,  -- n</span><br><span class="line">    publicExponent    INTEGER,  -- e</span><br><span class="line">    privateExponent   INTEGER,  -- d</span><br><span class="line">    prime1            INTEGER,  -- p</span><br><span class="line">    prime2            INTEGER,  -- q</span><br><span class="line">    exponent1         INTEGER,  -- d mod (p-1)</span><br><span class="line">    exponent2         INTEGER,  -- d mod (q-1)</span><br><span class="line">    coefficient       INTEGER,  -- (inverse of q) mod p</span><br><span class="line">    otherPrimeInfos   OtherPrimeInfos OPTIONAL</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Use-RSA"><a class="header-anchor" href="#Use-RSA"></a>Use RSA</h1>
<p>这里我们来演示一下直接加密一个消息</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 生成我们的私密消息</span></span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;This is our secret message.&quot;</span> &gt; secret.txt</span><br><span class="line"><span class="comment"># 使用 RSA 加密，注意要转换公钥格式到 PKCS8</span></span><br><span class="line">$ openssl rsautl -encrypt -oaep -pubin -inkey &lt;(ssh-keygen -e -m PKCS8 -f rsa.pub) -<span class="keyword">in</span> secret.txt -out secret.txt.enc</span><br><span class="line"><span class="comment"># 加密以后的文件是 secret.txt.enc</span></span><br><span class="line"><span class="comment"># 接下来使用 RSA 解密，同样要转换私钥格式</span></span><br><span class="line"><span class="comment"># 我们使用上文中得到的 PEM 格式私钥，rsa.pem</span></span><br><span class="line">$ openssl rsautl -decrypt -oaep -inkey rsa.pem -<span class="keyword">in</span> secret.txt.enc -out result.txt</span><br><span class="line"><span class="comment"># 验证一下是否得到了原始消息</span></span><br><span class="line">$ <span class="built_in">cat</span> result.txt</span><br><span class="line">This is our secret message.</span><br></pre></td></tr></table></figure>
<p>上面我们提到的 RSA 加密过程，也就是 ，也被称为教科书式 RSA。工程应用中，不会直接这样处理，而是会存在一个 Padding 的过程，具体不再展开，感兴趣可以去看 <a target="_blank" rel="noopener" href="https://eli.thegreenplace.net/2019/rsa-theory-and-implementation/">RSA - theory and implementation</a>。</p>
<p>注意，密码学中有很多微妙的问题要考虑。我们这里所做的一切都是为了学习和理解他们的工作原理，而不是为了自己去实现他们。<strong>千万不要自己去实现任何加密解密算法，专业的事情交给专业的人员处理就好</strong>.</p>
<p>[^1]: $m$​, $n$​ 不互质, 则$m$​与$n$​有1以外的公因数.  $m = pq$​ , $m$​ 的因数有: 1, $p$​, $q$​, $pq$​ . 因此 $n$​ 必定至少有因数 $p$​, $q$​, $pq$​ 之一, 因此 $m$​ 为 $p$​ 或 $q$​ 的倍数<br>
[^2]: &quot;若一个数是质数, 则两个数互质 == 另一个数不是前者的倍数&quot;</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Computer-Networking/" rel="tag"># Computer Networking</a>
              <a href="/tags/Cryptology/" rel="tag"># Cryptology</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/08/23/HTML-Basic/" rel="prev" title="HTML Basic">
                  <i class="fa fa-chevron-left"></i> HTML Basic
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/08/25/Python-OOP-Advanced/" rel="next" title="Python OOP Advanced">
                  Python OOP Advanced <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2021 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">有多远滚多远</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.0/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"ams","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
